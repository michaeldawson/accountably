- total_spend = budget.expenses.where(effective_date: budget.current_cycle).sum(:amount)
- percent_through_period = 100 - ((budget.current_cycle_days_remaining / budget.send(:cycle_as_date_delta).days.to_f) * 100).round

.container
  %h4 Budget overview

  .progress
    - if total_spend > budget.total
      .progress-bar.progress-bar-danger{style: "width: 100%"}
    - else
      .progress-bar.progress-bar-default{style: "width: #{percent_through_period}%"}

  %p #{budget.current_cycle.first} to #{budget.current_cycle.last} (#{budget.current_cycle_days_remaining} days remaining)
  %p
    You're #{percent_through_period}% of the way through this fortnight, and you've spent
    #{(total_spend.to_f / budget.total * 100).round}% of your budget.

  .row
    .col-md-4.col-sm-6
      .dashboard-stat{ class: total_spend > budget.total ? 'red' : 'green'}
        .visual
          %i.ion-ios-pie-outline
        .details
          .number= total_spend
          .desc Spent
        = link_to reconcile_accounts_path, class: 'more' do
          View unreconciled expenses
          %i.m-icon-swapright.m-icon-white

    .col-md-4.col-sm-6
      .dashboard-stat.blue
        .visual
          %i.ion-ios-settings
        .details
          .number $#{budget.total.dollars.to_i}
          .desc Budgeted
        = link_to edit_budget_path, class: 'more' do
          Manage budget
          %i.m-icon-swapright.m-icon-white

    .col-md-4.col-sm-6
      .dashboard-stat.purple
        .visual
          %i.ion-ios-cart-outline
        .details
          .number= budget.accounts.sum(:balance)
          .desc Available
        = link_to accounts_path, class: 'more' do
          View accounts
          %i.m-icon-swapright.m-icon-white
